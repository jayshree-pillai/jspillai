Feature: Company Overview prompt selection from configuration
  In order to produce a consistent Company Overview narrative structure
  As a Credit Analyst
  I want the Company Overview prompt to be selected by section_id from configuration

  Scenario: Resolve Company Overview prompt from configuration
    Given a configured mapping for section_id "company_overview"
    And a prompt bundle exists for the mapped prompt_id and active version
    When I request execution for section_id "company_overview"
    Then the system resolves the prompt_id and prompt_version from configuration
    And the resolved prompt_id and prompt_version are recorded in run metadata

  Scenario: Preview the rendered Company Overview prompt before execution
    Given a configured mapping for section_id "company_overview"
    When I request a prompt preview for section_id "company_overview"
    Then the system returns the fully rendered prompt text
    And the preview includes the resolved prompt_id and prompt_version

  Scenario: Fail fast when Company Overview mapping is missing
    Given no configured mapping exists for section_id "company_overview"
    When I request execution for section_id "company_overview"
    Then the system fails before any LLM call
    And the error clearly states the missing/unmapped section_id

  Scenario: Fail fast when configured prompt version is missing
    Given a configured mapping exists for section_id "company_overview"
    But the configured prompt version artifact does not exist
    When I request execution for section_id "company_overview"
    Then the system fails before any LLM call
    And the error includes the prompt_id and prompt_version that could not be resolved

  Scenario: Validate Company Overview output against its spec
    Given the Company Overview section output specification is defined
    And the system has executed section_id "company_overview"
    When the system validates the section output
    Then the output passes validation only if it conforms to the specification
    And on failure, a structured validation error is returned with failing fields/paths
