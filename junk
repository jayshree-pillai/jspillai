Feature: Guardrails enforce policy on every section output before schema validation
This covers running guardrails on every section, structured failures on violations, recording decisions, and no silent pass.

Scenario: Guardrails run on every section output before schema validation
Given a section run produces an output draft
When the section output is processed
Then the system applies guardrails to the output before schema validation
And the system does not return/assemble results until guardrails complete

Scenario: Policy violation blocks the output and returns a structured failure
Given guardrails are enabled
And a section output violates a policy rule
When guardrails evaluate the section output
Then the system returns a structured failure "POLICY_VIOLATION"
And the failure includes policy_rule_id (or rule name) and severity
And the failure includes the action_taken ("block" or "fail")

Scenario: Redaction action returns redacted output with an explicit status
Given guardrails are enabled
And a section output triggers a rule whose action is "redact"
When guardrails evaluate the section output
Then the system returns the redacted output
And the system marks the guardrail status as "REDACTED"
And schema validation runs on the redacted output

Scenario: Passing guardrails proceeds to schema validation
Given guardrails are enabled
And a section output does not violate any policy rule
When guardrails evaluate the section output
Then the system marks guardrail status "PASS"
And proceeds to schema validation

Scenario: Guardrail decisions are recorded for auditability (no silent pass)
Given a section is executed
When the section completes (pass, redact, or fail)
Then telemetry/logs record guardrail_status (PASS/REDACTED/FAIL)
And telemetry/logs record the rule id/name, severity, and action_taken (if applicable)
